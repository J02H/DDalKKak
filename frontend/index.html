<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê±´êµ­ëŒ€ ê¸€ë¡œì»¬ ê³µì§€ì‚¬í•­</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: white; padding: 20px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; border-bottom: 1px solid #ddd; }
        .logo { height: 80px; cursor: pointer; }
        .search-box { display: flex; align-items: center; }
        .search-box input { padding: 15px 20px; width: 400px; border: 1px solid #ddd; border-radius: 25px; font-size: 16px; }
        .search-box button { padding: 15px 25px; background: #036B3F; color: white; border: none; border-radius: 25px; cursor: pointer; margin-left: 10px; font-weight: bold; font-size: 16px; }
        .colleges { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .college { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .college h3 { color: #2c3e50; margin-bottom: 15px; border-bottom: 2px solid #036B3F; padding-bottom: 10px; }
        .department { background: #ecf0f1; margin: 10px 0; padding: 10px; border-radius: 5px; cursor: pointer; transition: all 0.3s; }
        .department:hover { background: #036B3F; color: white; }
        .notices { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 20px; }
        .notice { border-bottom: 1px solid #eee; padding: 15px 0; cursor: pointer; transition: background-color 0.2s; }
        .notice:hover { background-color: #f8f9fa; }
        .notice:last-child { border-bottom: none; }
        .notice-title { font-weight: bold; color: #2c3e50; margin-bottom: 5px; }
        .notice-meta { color: #7f8c8d; font-size: 14px; }
        .notice-detail { padding: 20px 0; }
        .notice-detail h2 { color: #2c3e50; margin-bottom: 15px; font-size: 24px; }
        .notice-content { background: #f8f9fa; padding: 20px; border-radius: 8px; }
        .notice-summary, .notice-actions, .notice-tips { margin: 20px 0; padding: 20px; border-radius: 8px; }
        .notice-summary { background: #e8f5e8; }
        .notice-actions { background: #f0f8ff; }
        .notice-tips { background: #fff8e1; }
        .notice-summary h3, .notice-actions h3, .notice-tips h3 { margin: 0 0 15px 0; color: #2c3e50; }
        .summary-content p { margin: 10px 0; line-height: 1.6; }
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .action-btn { padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .action-btn:not(.secondary) { background: #036B3F; color: white; }
        .action-btn.secondary { background: #6c757d; color: white; }
        .action-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .notice-tips ul { margin: 0; padding-left: 20px; }
        .notice-tips li { margin: 8px 0; line-height: 1.5; }
        .back-btn { background: #95a5a6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-bottom: 20px; }
        .loading { text-align: center; padding: 50px; color: #7f8c8d; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="images/ddalkkak_logo.png" alt="ë”¸ê¹ ë¡œê³ " class="logo" onclick="loadColleges()">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ê³µì§€ì‚¬í•­ ê²€ìƒ‰..." onkeypress="if(event.key==='Enter') searchNotices()">
                <button onclick="searchNotices()">ê²€ìƒ‰</button>
            </div>
        </div>

        <div id="content">
            <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';

        async function loadColleges() {
            try {
                const response = await fetch(`${API_BASE}/colleges`);
                const data = await response.json();
                
                if (data.success) {
                    displayColleges(data.colleges);
                }
            } catch (error) {
                document.getElementById('content').innerHTML = '<div class="loading">ì„œë²„ ì—°ê²° ì˜¤ë¥˜</div>';
            }
        }

        function displayColleges(colleges) {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="colleges">
                    ${colleges.map(college => `
                        <div class="college">
                            <h3>${college}</h3>
                            <div id="dept-${college}">í•™ê³¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                        </div>
                    `).join('')}
                </div>
            `;

            colleges.forEach(college => {
                loadDepartments(college);
            });
        }

        async function loadDepartments(college) {
            try {
                const response = await fetch(`${API_BASE}/departments/${encodeURIComponent(college)}`);
                const data = await response.json();
                
                if (data.success) {
                    const deptDiv = document.getElementById(`dept-${college}`);
                    deptDiv.innerHTML = data.departments.map(dept => `
                        <div class="department" onclick="loadNotices('${college}', '${dept}')">
                            ${dept}
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading departments:', error);
            }
        }

        async function loadNotices(college, department) {
            document.getElementById('content').innerHTML = '<div class="loading">ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/notices/${encodeURIComponent(college)}/${encodeURIComponent(department)}`);
                const data = await response.json();
                
                if (data.success) {
                    displayNotices(data);
                }
            } catch (error) {
                document.getElementById('content').innerHTML = '<div class="loading">ê³µì§€ì‚¬í•­ ë¡œë“œ ì˜¤ë¥˜</div>';
            }
        }

        function displayNotices(data) {
            const content = document.getElementById('content');
            content.innerHTML = `
                <button class="back-btn" onclick="loadColleges()">â† í•™ë¶€ ëª©ë¡ìœ¼ë¡œ</button>
                <div class="notices">
                    <h2>${data.college} > ${data.department}</h2>
                    <p style="margin-bottom: 20px; color: #7f8c8d;">ì´ ${data.notices.length}ê°œì˜ ê³µì§€ì‚¬í•­</p>
                    ${data.notices.map((notice, index) => `
                        <div class="notice" onclick="viewNoticeDetail('${data.college}', '${data.department}', ${index})">
                            <div class="notice-title">${notice.title}</div>
                            <div class="notice-meta">
                                ${notice.date ? `ğŸ“… ${notice.date}` : ''}
                                ${notice.date ? ' | ' : ''}ğŸ« ${notice.department}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function searchNotices() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            document.getElementById('content').innerHTML = '<div class="loading">ê²€ìƒ‰ ì¤‘...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.success) {
                    displaySearchResults(data);
                }
            } catch (error) {
                document.getElementById('content').innerHTML = '<div class="loading">ê²€ìƒ‰ ì˜¤ë¥˜</div>';
            }
        }

        function displaySearchResults(data) {
            const content = document.getElementById('content');
            content.innerHTML = `
                <button class="back-btn" onclick="loadColleges()">â† í•™ë¶€ ëª©ë¡ìœ¼ë¡œ</button>
                <div class="notices">
                    <h2>ê²€ìƒ‰ ê²°ê³¼: "${data.query}"</h2>
                    <p style="margin-bottom: 20px; color: #7f8c8d;">ì´ ${data.count}ê°œì˜ ê²°ê³¼</p>
                    ${data.results.map(notice => `
                        <div class="notice" onclick="viewNoticeDetail('${notice.college}', '${notice.department}', ${notice.notice_id})">
                            <div class="notice-title">${notice.title}</div>
                            <div class="notice-meta">
                                ${notice.date ? `ğŸ“… ${notice.date}` : ''}
                                ${notice.date ? ' | ' : ''}ğŸ« ${notice.college} > ${notice.department}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function viewNoticeDetail(college, department, noticeId) {
            try {
                const response = await fetch(`${API_BASE}/notice/${encodeURIComponent(college)}/${encodeURIComponent(department)}/${noticeId}`);
                const data = await response.json();
                
                if (data.success) {
                    displayNoticeDetail(data);
                }
            } catch (error) {
                document.getElementById('content').innerHTML = '<div class="loading">ê³µì§€ì‚¬í•­ ë¡œë“œ ì˜¤ë¥˜</div>';
            }
        }

        function getNoticeSummary(title) {
            const keywords = {
                'ê°•ì˜í‰ê°€': 'í•™ìƒë“¤ì´ ìˆ˜ê°•í•œ ê°•ì˜ì— ëŒ€í•œ í‰ê°€ë¥¼ ì§„í–‰í•˜ëŠ” ê¸°ê°„ì…ë‹ˆë‹¤. ìˆ˜ê°• ì‹ ì²­ ì‹œìŠ¤í…œì—ì„œ ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                'ìˆ˜ê°•ì‹ ì²­': 'ë‹¤ìŒ í•™ê¸° ìˆ˜ê°•ì‹ ì²­ ê¸°ê°„ì— ëŒ€í•œ ì•ˆë‚´ì…ë‹ˆë‹¤. ì‹œê°„í‘œë¥¼ ë¯¸ë¦¬ í™•ì¸í•˜ê³  ì¤€ë¹„í•˜ì„¸ìš”.',
                'ì¥í•™': 'ì¥í•™ê¸ˆ ì‹ ì²­ ë° ì„ ë°œì— ê´€í•œ ê³µì§€ì…ë‹ˆë‹¤. ìê²© ìš”ê±´ê³¼ ì‹ ì²­ ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.',
                'ì¡¸ì—…': 'ì¡¸ì—… ìš”ê±´ ë° ì ˆì°¨ì— ê´€í•œ ì¤‘ìš”í•œ ì •ë³´ì…ë‹ˆë‹¤. ì¡¸ì—…ì˜ˆì •ìëŠ” ë°˜ë“œì‹œ í™•ì¸í•˜ì„¸ìš”.',
                'íŠ¹ê°•': 'ì™¸ë¶€ ì „ë¬¸ê°€ë‚˜ ì—…ê³„ ì „ë¬¸ê°€ì˜ íŠ¹ë³„ ê°•ì—°ì…ë‹ˆë‹¤. ì „ê³µ ì§€ì‹ í–¥ìƒì— ë„ì›€ì´ ë©ë‹ˆë‹¤.',
                'ì‹¤ìŠµ': 'ì‹¤ë¬´ ê²½í—˜ì„ ìŒ“ì„ ìˆ˜ ìˆëŠ” ì‹¤ìŠµ ê¸°íšŒì…ë‹ˆë‹¤. ì·¨ì—… ì¤€ë¹„ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.',
                'ê³µëª¨ì „': 'ë‹¤ì–‘í•œ ê³µëª¨ì „ ì°¸ê°€ ê¸°íšŒì…ë‹ˆë‹¤. ìˆ˜ìƒ ê²½ë ¥ì„ ìŒ“ê³  ìƒê¸ˆë„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                'í•™ìƒíšŒ': 'í•™ìƒíšŒ í™œë™ ë° ì„ ê±°ì— ê´€í•œ ì •ë³´ì…ë‹ˆë‹¤. í•™ê³¼ ëŒ€í‘œë¡œ í™œë™í•  ê¸°íšŒì…ë‹ˆë‹¤.'
            };
            
            for (const [keyword, description] of Object.entries(keywords)) {
                if (title.includes(keyword)) {
                    return `<p><strong>ğŸ¯ ì£¼ìš” ë‚´ìš©:</strong> ${description}</p>`;
                }
            }
            
            return `<p><strong>ğŸ“ ê³µì§€ì‚¬í•­:</strong> ${title}</p><p>ìì„¸í•œ ë‚´ìš©ì€ í•´ë‹¹ í•™ê³¼ì— ë¬¸ì˜í•˜ì‹œê±°ë‚˜ ê³µì§€ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>`;
        }
        
        function openDepartmentPage(department) {
            const deptUrls = {
                'ì‹¤ë‚´ë””ìì¸í•™ê³¼': 'https://interior.kku.ac.kr',
                'íŒ¨ì…˜ë””ìì¸í•™ê³¼': 'https://fashion.kku.ac.kr',
                'ì‹œê°ì˜ìƒë””ìì¸í•™ê³¼': 'https://visualad.kku.ac.kr',
                'ë¯¸ë””ì–´ì½˜í…ì¸ í•™ê³¼': 'https://mediacontents.kku.ac.kr',
                'ì»´í“¨í„°ê³µí•™ê³¼': 'https://cs.kku.ac.kr',
                'ìƒëª…ê³µí•™ê³¼': 'https://biotech.kku.ac.kr',
                'KUììœ ì „ê³µí•™ë¶€': 'https://kls.kku.ac.kr'
            };
            
            const url = deptUrls[department] || 'https://www.kku.ac.kr';
            window.open(url, '_blank');
        }
        
        function shareNotice(title, college, department) {
            if (navigator.share) {
                navigator.share({
                    title: `${title} - ${college} ${department}`,
                    text: `ê±´êµ­ëŒ€ ê¸€ë¡œì»¬ìº í¼ìŠ¤ ${college} ${department} ê³µì§€ì‚¬í•­`,
                    url: window.location.href
                });
            } else {
                const text = `${title} - ${college} ${department}\n${window.location.href}`;
                navigator.clipboard.writeText(text).then(() => {
                    alert('ê³µì§€ì‚¬í•­ ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                });
            }
        }

        function displayNoticeDetail(data) {
            const content = document.getElementById('content');
            const notice = data.notice;
            
            content.innerHTML = `
                <button class="back-btn" onclick="loadNotices('${data.college}', '${data.department}')">â† ${data.department} ëª©ë¡ìœ¼ë¡œ</button>
                <div class="notices">
                    <div class="notice-detail">
                        <h2>${notice.title}</h2>
                        <div class="notice-meta" style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                            ${notice.date ? `ğŸ“… ${notice.date}` : ''}
                            ${notice.date ? ' | ' : ''}ğŸ« ${data.college} > ${data.department}
                        </div>
                        
                        <div class="notice-content">
                            <div class="notice-summary">
                                <h3>ğŸ“ ê³µì§€ì‚¬í•­ ìš”ì•½</h3>
                                <div class="summary-content">
                                    ${getNoticeSummary(notice.title)}
                                </div>
                            </div>
                            
                            <div class="notice-actions">
                                <h3>ğŸ”— ê´€ë ¨ ë§í¬</h3>
                                <div class="action-buttons">
                                    ${notice.link && notice.link.includes('javascript:fn_goDetail') ? 
                                        `<button class="action-btn" onclick="openDepartmentPage('${data.department}')">
                                            ğŸ« ${data.department} í™ˆí˜ì´ì§€ ë°©ë¬¸
                                        </button>` : 
                                        `<button class="action-btn" onclick="window.open('${notice.link}', '_blank')">
                                            ğŸ”— ì›ë¬¸ ë³´ê¸°
                                        </button>`
                                    }
                                    <button class="action-btn secondary" onclick="shareNotice('${notice.title}', '${data.college}', '${data.department}')">
                                        ğŸ“¤ ê³µì§€ì‚¬í•­ ê³µìœ 
                                    </button>
                                </div>
                            </div>
                            
                            <div class="notice-tips">
                                <h3>ğŸ’¡ ë„ì›€ë§</h3>
                                <ul>
                                    <li>ì¤‘ìš”í•œ ê³µì§€ì‚¬í•­ì€ ë¶ë§ˆí¬í•˜ì—¬ ë‚˜ì¤‘ì— ë‹¤ì‹œ í™•ì¸í•˜ì„¸ìš”</li>
                                    <li>ë§ˆê°ì¼ì´ ìˆëŠ” ê³µì§€ëŠ” ìº˜ë¦°ë”ì— ë“±ë¡í•´ë‘ì„¸ìš”</li>
                                    <li>ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ë©´ í•´ë‹¹ í•™ê³¼ ì‚¬ë¬´ì‹¤ì— ë¬¸ì˜í•˜ì„¸ìš”</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        loadColleges();
    </script>
</body>
</html>